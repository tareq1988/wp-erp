!function(o){"use strict";var r={initialize:function(){var e=this;o(".erp-hr-leave-policy").on("click","a.submitdelete",e,this.policy.remove),o("body").on("change","#erp-hr-leave-req-from-date, #erp-hr-leave-req-to-date",e,this.leave.requestDates),o("body").on("change","#erp-hr-leave-req-employee-id",e,this.leave.setPolicy),o("body").on("change","#erp-hr-leave-req-leave-policy",e,this.leave.setAvailableDays),o(".hrm-dashboard").on("click",".erp-hr-new-leave-request-wrap a#erp-hr-new-leave-req",this.leave.takeLeave),o(".erp-employee-single").on("submit","form#erp-hr-empl-leave-history",this.leave.showHistory),o(".entitlement-list-table").on("click","a.submitdelete",e,this.entitlement.remove),o(".erp-hr-holiday-wrap").on("click","a#erp-hr-new-holiday",e,this.holiday.create),o(".erp-hr-holiday-wrap").on("click",".erp-hr-holiday-edit",e,this.holiday.edit),o(".erp-hr-holiday-wrap").on("click",".erp-hr-holiday-delete",e,this.holiday.remove),o("body").on("change",".erp-hr-holiday-date-range",e,this.holiday.checkRange),o(".erp-hr-holiday-wrap").on("click","#erp-hr-import-ical",e,this.importICalInit),o(".erp-hr-holiday-wrap").on("change","#erp-ical-input",e,this.uploadICal),o(".erp-hr-leave-requests").on("click",".erp-hr-leave-reject-btn",e,this.leave.reject),o("#filter_year").on("change",e,this.customFilterLeaveReport),o('input[name="end"], input[name="start"]').on("change",e,this.checkDateRange),o(".leave-entitlement-form").on("change","#assignment_to",e,this.entitlement.hideEmployee),o(".leave-entitlement-form#assignment_to").change(),this.entitlement.getLeavePolicies(),o(".leave-entitlement-form").on("change",".change_policy",e,this.entitlement.getLeavePolicies),this.entitlement.getFilteredEmployee(),o(".leave-entitlement-form").on("change",".change_policy",e,this.entitlement.getFilteredEmployee),this.initDateField()},initToggleCheckbox:function(){var a=!1;o("tbody").children().children(".check-column").find(":checkbox").click(function(e){if("undefined"==e.shiftKey)return!0;if(e.shiftKey){if(!a)return!0;checks=o(a).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(a),last=checks.index(this),checked=o(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!o(this).closest("tr").is(":visible")&&checked}))}var t=o(a=this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return o(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===t.length}),!0}),o("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(e){var t=o(this),a=t.closest("table"),i=t.prop("checked"),r=e.shiftKey||t.data("wp-toggle");a.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!o(this).is(":hidden,:disabled")&&(r?!o(this).prop("checked"):!!i)}),a.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!r&&!!i})})},initDateField:function(){o(".erp-leave-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),o(".erp-leave-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(e){o(".erp-leave-date-picker-to").datepicker("option","minDate",e)}}),o(".erp-leave-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(e){o(".erp-leave-date-picker-from").datepicker("option","maxDate",e)}}),o(".erp-color-picker").wpColorPicker()},holiday:{checkRange:function(){o('input[name="range"]').is(":checked")?o('input[name="end_date"]').closest(".row").show():o('input[name="end_date"]').closest(".row").hide()},create:function(t){t.preventDefault(),o.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_create,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){r.initDateField(),r.holiday.checkRange(),r.initToggleCheckbox()},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},edit:function(t){t.preventDefault();var e=o(this);o.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_update,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){r.initDateField(),r.holiday.checkRange();var n=this;o("header",n).after(o('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-holiday",{data:{id:e.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){o(".loader",n).remove();var t=e.holiday;o("#erp-hr-holiday-title",n).val(t.title),o("#erp-hr-holiday-start",n).val(t.start),o("#erp-hr-holiday-end",n).val(t.end),o("#erp-hr-holiday-id",n).val(t.id),o("#erp-hr-holiday-description",n).val(t.description),o("#erp-hr-holiday-action",n).val("erp_hr_holiday_create");var a=new Date(t.start),i=new Date(t.end),r=Math.abs(i.getTime()-a.getTime());0<Math.ceil(r/864e5)&&(o("#erp-hr-holiday-range").attr("checked","checked"),o("#erp-hr-holiday-range").trigger("change"))}})},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},remove:function(e){e.preventDefault();var t=o(this);confirm(wpErpHr.delConfirmHoliday)&&wp.ajax.send("erp-hr-holiday-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){o(this).remove()})},error:function(e){alert(e)}})},submit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),o(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){r.initDateField(),r.initToggleCheckbox()})},error:function(e){t.enableButton(),t.showError(e)}})}},policy:{remove:function(e){e.preventDefault();var t=o(this);confirm(wpErpHr.delConfirmPolicy)&&wp.ajax.send("erp-hr-leave-policy-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){o(this).remove()})},error:function(e){alert(e)}})}},entitlement:{remove:function(e){e.preventDefault();var t=o(this);confirm(wpErpHr.delConfirmEntitlement)&&wp.ajax.send("erp-hr-leave-entitlement-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id"),user_id:t.data("user_id"),policy_id:t.data("policy_id")},success:function(){t.closest("tr").fadeOut("fast",function(){o(this).remove()})},error:function(e){alert(e)}})},hideEmployee:function(e){e.preventDefault(),o(this).is(":checked")?o(".single_employee_field").hide():o(".single_employee_field").show()},getLeavePolicies:function(){o(".leave-entitlement-form .leave_policy").prop("disabled",!0);var e=o(".leave-entitlement-form .department_id").select2("data"),t=o(".leave-entitlement-form .designation_id").select2("data"),a=o(".leave-entitlement-form .location_id").select2("data"),i=o(".leave-entitlement-form .gender").select2("data"),r=o(".leave-entitlement-form .marital").select2("data"),n=o(".leave-entitlement-form .f_year").select2("data");wp.ajax.send("erp-hr-leave-get-policies",{data:{_wpnonce:wpErpHr.nonce,department_id:e[0].id,designation_id:t[0].id,location_id:a[0].id,gender:i[0].id,marital:r[0].id,f_year:n[0].id},success:function(e){var i=o(".leave-entitlement-form .leave_policy");i.find("option").remove(),o.each(e,function(e,t){var a=new Option(t,e);i.append(a)}),i.trigger("change"),i.prop("disabled",!1)},error:function(e){console.log(e)}})},getFilteredEmployee:function(){o(".leave-entitlement-form .single_employee").prop("disabled",!0);var e=o(".leave-entitlement-form .department_id").select2("data"),t=o(".leave-entitlement-form .designation_id").select2("data"),a=o(".leave-entitlement-form .location_id").select2("data"),i=o(".leave-entitlement-form .gender").select2("data"),r=o(".leave-entitlement-form .marital").select2("data");wp.ajax.send("erp-hr-leave-get-employees",{data:{_wpnonce:wpErpHr.nonce,department_id:e[0].id,designation_id:t[0].id,location_id:a[0].id,gender:i[0].id,marital:r[0].id},success:function(e){var i=o(".leave-entitlement-form .single_employee");i.find("option").remove(),o.each(e,function(e,t){var a=new Option(t,e);i.append(a)}),i.trigger("change"),i.prop("disabled",!1)},error:function(e){console.log(e)}})}},leave:{takeLeave:function(e){e.preventDefault(),o.erpPopup({title:wpErpHr.popup.new_leave_req,button:wpErpHr.popup.take_leave,id:"erp-hr-new-leave-req-popup",content:wp.template("erp-new-leave-req")().trim(),extraClass:"smaller",onReady:function(){r.initDateField()},onSubmit:function(t){o("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send({data:this.serialize(),success:function(e){t.enableButton(),alert(e),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},requestDates:function(){var e=o("#erp-hr-leave-req-from-date").val(),t=o("#erp-hr-leave-req-to-date").val(),a=o(this).closest("form").find('*[type="submit"]'),i=parseInt(o("#erp-hr-leave-req-employee-id").val()),r=o("#erp-hr-leave-req-leave-policy").val();""!==e&&""!==t&&wp.ajax.send("erp-hr-leave-request-req-date",{data:{_wpnonce:wpErpHr.nonce,from:e,to:t,employee_id:i,type:r},success:function(e){var t=wp.template("erp-leave-days")(e.print);o("div.erp-hr-leave-req-show-days").html(t),parseInt(e.leave_count)<=0?a.prop("disabled",!0):a.prop("disabled",!1)},error:function(e){o("div.erp-hr-leave-req-show-days").empty(),a.attr("disabled","disable"),void 0!==e&&alert(e)}})},setPolicy:function(){r.leave.resetDateRange();var e=o(this),t=o("div.erp-hr-leave-reqs-wrap"),a=t.find(".erp-hr-leave-type-wrapper");a.html(""),0!=e.val()&&wp.ajax.send("erp-hr-leave-employee-assign-policies",{data:{_wpnonce:wpErpHr.nonce,employee_id:e.val()},success:function(e){a.html(e).hide().fadeIn(),t.find('input[type="text"], textarea').removeAttr("disabled")},error:function(e){a.html(wpErpHr.empty_entitlement_text).hide().fadeIn()}})},setAvailableDays:function(){r.leave.resetDateRange();var t=o(this);wp.ajax.send("erp-hr-leave-policies-availablity",{data:{_wpnonce:wpErpHr.nonce,employee_id:o("#erp-hr-leave-req-employee-id").val(),policy_id:t.val()},success:function(e){t.closest("div.row").find("span.description").remove(),o(e).insertAfter(t)},error:function(e){alert(e)}})},resetDateRange:function(){o("#erp-hr-leave-req-from-date").val(""),o("#erp-hr-leave-req-to-date").val(""),o("div.erp-hr-leave-req-show-days").html("")},showHistory:function(e){e.preventDefault();var t=o(this);wp.ajax.send("erp-hr-empl-leave-history",{data:t.serializeObject(),success:function(e){o("table#erp-hr-empl-leave-history-table tbody").html(e)}})},pageReload:function(){o(".erp-hr-leave-requests").load(window.location.href+" .erp-hr-leave-requests-inner")},reject:function(e){e.preventDefault();var t={id:o(this).data("id")};o.erpPopup({title:wpErpHr.popup.leave_reject,button:wpErpHr.popup.update_status,id:"erp-hr-leave-reject-popup",content:wperp.template("erp-hr-leave-reject-js-tmp")(t).trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize()+"&_wpnonce="+wpErpHr.nonce,success:function(e){r.leave.pageReload(),t.closeModal()},error:function(e){t.showError(e)}})}})}},importICalInit:function(e){e.preventDefault(),o("body #erp-ical-input").trigger("click")},uploadICal:function(e){e.preventDefault();var t=e.target.files[0],a=new FormData,i=o(this).parents("form");a.append("ics",t),a.append("action","erp-hr-import-ical"),a.append("_wpnonce",wpErpHr.nonce),wp.ajax.send({data:a,cache:!1,processData:!1,contentType:!1,success:function(){o(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){r.initDateField()}),i[0].reset()},error:function(e){i[0].reset(),alert(e)}})},customFilterLeaveReport:function(){if("custom"!=this.value)o("#custom-input").remove();else{o("#custom-date-range").after('<span id="custom-input" style="float:left"><span>From </span><input name="start" class="erp-leave-date-field" type="text">&nbsp;<span>To </span><input name="end" class="erp-leave-date-field" type="text"></span>')}r.initDateField()},checkDateRange:function(){var e=new Date(this.value).getFullYear();(new Date).getFullYear()<e&&(alert("Enter date range between current year"),this.value="")}};o(function(){r.initialize()})}(jQuery);