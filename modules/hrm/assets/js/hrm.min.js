!function(s){"use strict";var l={initialize:function(){self=this,s("ul.erp-dashboard-announcement").on("click","a.mark-read",this.dashboard.markAnnouncementRead),s("ul.erp-dashboard-announcement").on("click","a.view-full",this.dashboard.viewAnnouncement),s("ul.erp-dashboard-announcement").on("click",".announcement-title a",this.dashboard.viewAnnouncementTitle),s("ul.erp-list").on("click",".send-wish",this.dashboard.sendBirthdayWish),s("body").on("click","a#erp-new-dept",this.department.create),s(".erp-hr-depts").on("click","a.submitdelete",this.department.remove),s(".erp-hr-depts").on("click","span.edit a",this.department.edit),s("body").on("click","a#erp-new-designation",this.designation.create),s(".erp-hr-designation").on("click","a.submitdelete",this.designation.remove),s(".erp-hr-designation").on("click","span.edit a",this.designation.edit),s(".erp-hr-employees").on("click","a#erp-employee-new",this.employee.create),s(".erp-hr-employees").on("click","span.edit a",this.employee.edit),s(".erp-hr-employees").on("click","a.submitdelete",this.employee.remove),s(".erp-hr-employees").on("click","a.submitrestore",this.employee.restore),s(".erp-hr-employees").on("click","a#erp-empl-type",this.employee.updateJobStatus),s(".erp-hr-employees").on("click","a#erp-empl-status",this.employee.updateJobStatus),s(".erp-hr-employees").on("click","a#erp-empl-compensation",this.employee.updateJobStatus),s(".erp-hr-employees").on("click","a#erp-empl-jobinfo",this.employee.updateJobStatus),s(".erp-hr-employees").on("click","td.action a.remove",this.employee.removeHistory),s(".erp-hr-employees").on("click","td.action a.edit",this.employee.editHistory),s(".erp-hr-employees").on("click","a#erp-employee-print",this.employee.printData),s("body").on("focusout","input#erp-hr-user-email",this.employee.checkUserEmail),s("body").on("click","a#erp-hr-create-wp-user-to-employee",this.employee.makeUserEmployee),s(".erp-employee-single").on("click","a#erp-employee-terminate",this.employee.terminateEmployee),s(".erp-employee-single").on("click","input#erp-hr-employee-status-update",this.employee.changeEmployeeStatus),s(".erp-hr-employees").on("click","a#erp-empl-performance-reviews",this.employee.updatePerformance),s(".erp-hr-employees").on("click","a#erp-empl-performance-comments",this.employee.updatePerformance),s(".erp-hr-employees").on("click","a#erp-empl-performance-goals",this.employee.updatePerformance),s(".erp-hr-employees").on("click",".performance-tab-wrap td.action a.performance-remove",this.employee.removePerformance),s(".erp-hr-employees").on("click","a#erp-empl-add-exp",this.employee.general.create),s(".erp-hr-employees").on("click","a.work-experience-edit",this.employee.general.create),s(".erp-hr-employees").on("click","a.work-experience-delete",this.employee.general.remove),s(".erp-hr-employees").on("click","a#erp-empl-add-education",this.employee.general.create),s(".erp-hr-employees").on("click","a.education-edit",this.employee.general.create),s(".erp-hr-employees").on("click","a.education-delete",this.employee.general.remove),s("body").on("change","#result_type",self,this.employee.general.selectResultType),s(".erp-hr-employees").on("click","a#erp-empl-add-dependent",this.employee.general.create),s(".erp-hr-employees").on("click","a.dependent-edit",this.employee.general.create),s(".erp-hr-employees").on("click","a.dependent-delete",this.employee.general.remove),s(".erp-hr-employees").on("submit",".note-tab-wrap form",this.employee.addNote),s(".erp-hr-employees").on("click",".note-tab-wrap input#erp-load-notes",this.employee.loadNotes),s(".erp-hr-employees").on("click",".note-tab-wrap a.delete_note",this.employee.deleteNote),s("body").on("click","a#erp-set-emp-photo",this.employee.setPhoto),s("body").on("click","a.erp-remove-photo",this.employee.removePhoto),s("body").on("erp-hr-after-new-dept",this.department.afterNew),s("body").on("erp-hr-after-new-desig",this.designation.afterNew),s("body").on("change",".wp-list-table",function(e){s('.wp-list-table tbody tr th input[type="checkbox"]').is(":checked")?(s(".tablenav .bulkactions").show(),s(".tablenav").css("clear","both"),s(".wperp-filter-dropdown").css("margin-top","-63px")):(s(".tablenav .bulkactions").hide(),s(".tablenav").css("clear","none"),s(".wperp-filter-dropdown").css("margin-top","-53px"))}),s("body").on("click",".wperp-filter-dropdown a",this.employee.toggleFilterDropdown),s("body").on("click",'input[name="hide_filter"]',function(e){e.preventDefault(),self.employee.toggleFilterDropdown()}),s("body").on("click",'input[name="reset_filter"]',function(e){e.preventDefault(),s("#filter_designation option:selected").prop("selected",!1),s("#filter_department option:selected").prop("selected",!1),s("#filter_employment_type option:selected").prop("selected",!1),s("input[name=filter_employee]").click()}),s("#erp-hr-employee-import-csv").on("click",this.employee.importCsv),s("#erp-hr-employee-export-csv").on("click",this.employee.exportCsv),this.showRequestNotification(),this.initTipTip(),s("body").on("click",'input[name="reset_announcement_filter"]',function(e){e.preventDefault(),s("#start_date").val(""),s("#end_date").val(""),s("#erp-announcement-table-wrap .list-table-inner form").submit()}),s("body").on("click","input[name=filter_announcements]",this.announcement.validateFilterForm),s("tbody#the-list tr td.sent_to span.expand-for-more-ann").click(this.announcement.sentToDetails)},initToggleCheckbox:function(){var r=!1;s("tbody").children().children(".check-column").find(":checkbox").click(function(e){if("undefined"==e.shiftKey)return!0;if(e.shiftKey){if(!r)return!0;checks=s(r).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(r),last=checks.index(this),checked=s(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!s(this).closest("tr").is(":visible")&&checked}))}var t=s(r=this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return s(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===t.length}),!0}),s("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(e){var t=s(this),r=t.closest("table"),o=t.prop("checked"),n=e.shiftKey||t.data("wp-toggle");r.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!s(this).is(":hidden,:disabled")&&(n?!s(this).prop("checked"):!!o)}),r.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!n&&!!o})})},initTipTip:function(){s(".erp-tips").tipTip({defaultPosition:"top",fadeIn:100,fadeOut:100})},requiredAlert:function(e){var t=0;if(s("edit"===e?"#erp-employee-edit form":"#erp-new-employee-popup form").find("input, select, textarea").each(function(){s(this).prop("required")&&""===s(this).val()&&t++}),t){var r=wpErpHr.required_field_notice.replace("{count}",t);swal("",r,"warning")}},initDateField:function(){s(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+100"}),s(".erp-hr-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:-2"})},reloadPage:function(){s(".erp-area-left").load(window.location.href+" #erp-area-left-inner",function(){s(".select2").select2()})},ajaxReq:function(e,t){wp.ajax.send({data:e,success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})},showRequestNotification:function(){var e=".erp-custom-menu-container .erp-nav .requests a",t="span.erp-notification",r=0;wp.ajax.send({data:{action:"erp_hr_get_total_pending_requests"},success:function(e){r=e},error:function(e){r=0}}).then(function(){0<r&&(s(e).find(t).length?s(e+" "+t).html(r):s(e).append(' <span class="erp-notification">'+r+"</span>"))})},dashboard:{markAnnouncementRead:function(e){e.preventDefault();var t=s(this);t.closest("li").hasClass("unread")&&wp.ajax.send("erp_hr_announcement_mark_read",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){t.closest("li").removeClass("unread").addClass("read"),t.addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncementTitle:function(e){e.preventDefault();var t=s(this).closest("li").find("a.view-full");wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){s.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncement:function(e){e.preventDefault();var t=s(this);wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){s.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},sendBirthdayWish:function(e){e.preventDefault();var t=s(this);s(".wait").show(),t.find("i").hide(),wp.ajax.send("erp_hr_birthday_wish",{data:{employee_user_id:t.data("user_id"),_wpnonce:wpErpHr.nonce},success:function(e){s(".wait").hide(),alert(e)},error:function(e){alert(e)}})}},department:{afterNew:function(e,t){var r=s(".erp-hr-dept-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),r.select2().select2("val",t.id)},reload:function(){s("#erp-dept-table-wrap").load(window.location.href+" #erp-dept-table-wrap",function(){l.initToggleCheckbox()})},tempReload:function(){wperp.scriptReload("erp_hr_new_dept_tmp_reload","tmpl-erp-new-dept")},create:function(e){e.preventDefault();var r=s(this).data("single");s.erpPopup({title:wpErpHr.popup.dept_title,button:wpErpHr.popup.dept_submit,id:"erp-hr-new-department",content:wperp.template("erp-new-dept")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){l.department.reload(),"1"!=r?s("body").trigger("erp-hr-after-new-dept",[e]):l.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=s(this);s.erpPopup({title:wpErpHr.popup.dept_update,button:wpErpHr.popup.dept_update,id:"erp-hr-new-department",content:wp.template("erp-new-dept")().trim(),extraClass:"smaller",onReady:function(){var t=this;s("header",t).after(s('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-dept",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){s(".loader",t).remove(),s("#dept-title",t).val(e.name),s("#dept-desc",t).val(e.data.description),s("#dept-parent",t).val(e.data.parent),s("#dept-lead",t).val(e.data.lead),s("#dept-id",t).val(e.id),s("#dept-action",t).val("erp-hr-update-dept"),s('#dept-parent option[value="'+r.data("id")+'"]',t).attr("disabled","disabled")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){l.department.reload(),l.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=s(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-dept",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){s(this).remove(),l.department.tempReload()})},error:function(e){alert(e)}})}},designation:{afterNew:function(e,t){var r=s(".erp-hr-desi-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),l.employee.select2AddMoreActive("erp-hr-desi-drop-down"),r.select2("val",t.id)},reload:function(){s(".erp-hr-designation").load(window.location.href+" .erp-hr-designation",function(){l.initToggleCheckbox()})},create:function(e){e.preventDefault();var r=s(this).data("single");s.erpPopup({title:wpErpHr.popup.desig_title,button:wpErpHr.popup.desig_submit,id:"erp-hr-new-designation",content:wp.template("erp-new-desig")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){l.designation.reload(),"1"!=r&&s("body").trigger("erp-hr-after-new-desig",[e]),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=s(this);s.erpPopup({title:wpErpHr.popup.desig_update,button:wpErpHr.popup.desig_update,content:wp.template("erp-new-desig")().trim(),id:"erp-hr-new-designation",extraClass:"smaller",onReady:function(){var t=this;s("header",t).after(s('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-desig",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){s(".loader",t).remove(),s("#desig-title",t).val(e.name),s("#desig-desc",t).val(e.data.description),s("#desig-id",t).val(e.id),s("#desig-action",t).val("erp-hr-update-desig")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){l.designation.reload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=s(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-desig",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){s(this).remove()})},error:function(e){alert(e)}})}},employee:{reload:function(){s(".erp-hr-employees-wrap").load(window.location.href+" .erp-hr-employees-wrap-inner",function(){l.initToggleCheckbox()})},setPhoto:function(e){var t;e.preventDefault(),e.stopPropagation(),t||(t=wp.media({title:wpErpHr.emp_upload_photo,button:{text:wpErpHr.emp_set_photo}})).on("select",function(){t.state().get("selection").map(function(e){var t='<img src="'+(e=e.toJSON()).url+'" alt="" />';t+='<input type="hidden" id="emp-photo-id" name="personal[photo_id]" value="'+e.id+'" />',t+='<a href="#" class="erp-remove-photo">&times;</a>',s(".photo-container",".erp-employee-form").html(t)})}),t.open()},removePhoto:function(e){e.preventDefault();var t='<img src="'+(wpErpHr.asset_url+"/images/mystery-person.png")+'" alt="">';t+='<input type="hidden" name="personal[photo_id]" id="emp-photo-id" value="0">',t+='<a href="#" id="erp-set-emp-photo" class="button-primary"><i class="fa fa-cloud-upload"></i>'+wpErpHr.emp_upload_photo+"</a>",s(".photo-container",".erp-employee-form").html(t)},importCsv:function(e){void 0!==e&&e.preventDefault();var t=s(this);s.erpPopup({title:t.data("title"),button:t.data("btn"),id:"erp-employee-import",content:wperp.template("erp-employee-import-csv")({}),extraClass:"medium",onReady:function(){var e="#erp-employee-import form.erp-modal-form";s("#erp-employee-csv-import-error").hide(),s("#erp-employee-csv-import-error").html(""),s(e).attr("enctype","multipart/form-data"),s(e).attr("id","import_form"),s("button#erp-employee-sample-csv").on("click",function(e){e.preventDefault();var t=s(this).data("url");window.location.href=t}),s("form#import_form #csv_file").on("change",function(e){e.preventDefault(),this&&l.employee.processCsvImporter(this)})},onSubmit:function(t){s("button[type=submit]",".erp-modal").attr("disabled","disabled"),s("#erp-employee-csv-import-error").hide(),s("#erp-employee-csv-import-error").html("");var e=new FormData(this.get(0));wp.ajax.send({data:e,processData:!1,contentType:!1,success:function(e){t.enableButton(),t.closeModal(),l.employee.reload(),swal("",e,"success")},error:function(e){t.enableButton(),s(".erp-modal-backdrop, .erp-modal").find(".erp-loader").addClass("erp-hide"),s("#erp-employee-csv-import-error").show(),s("#erp-employee-csv-import-error").html(e),s("#import_form > div").animate({scrollTop:0},"fast")}})}})},exportCsv:function(e){void 0!==e&&e.preventDefault();var t=s(this);s.erpPopup({title:t.data("title"),button:t.data("btn"),id:"erp-employee-export",content:wperp.template("erp-employee-export-csv")({}),extraClass:"",onReady:function(){var e="employee",t=wpErpHr.erp_fields[e]?wpErpHr.erp_fields[e].fields:[],r="";s("#erp-employee-export form.erp-modal-form").attr("id","export_form");for(var o=0;o<t.length;o++)r+='<div class="col-1"><label><input type="checkbox" name="fields[]" value="'+t[o]+'"> '+l.employee.strTitleCase(t[o])+"</label></div>";r&&s("form#export_form #fields").html(r),s("#export_form #selecctall").change(function(e){e.preventDefault(),s("#export_form #fields input[type=checkbox]").prop("checked",s(this).prop("checked"))})},onSubmit:function(e){this.unbind("submit"),this.get(0).submit(),e.closeModal()}})},processCsvImporter:function(e){s("#erp-csv-fields-container").show();for(var t="",r="employee",o="",n="",a=wpErpHr.erp_fields[r]?wpErpHr.erp_fields[r].fields:[],i=wpErpHr.erp_fields[r]?wpErpHr.erp_fields[r].required_fields:[],p=0;p<a.length;p++)n=-1!==i.indexOf(a[p])?(o="required",' <span class="required">*</span>'):o="",t+='<tr><th><label for="fields['+a[p]+']" class="csv_field_labels">'+l.employee.strTitleCase(a[p])+n+'</label></th><td><select name="fields['+a[p]+']" class="csv_fields" '+o+"></select></td></tr>";s("#erp-csv-fields-container").html(t),l.employee.mapCsvFields(e,".csv_fields")},mapCsvFields:function(e,o){var t=e.files[0],n=new FileReader,r=t.slice(0,5e3);n.readAsText(r),n.onload=function(e){var t=n.result.split("\n")[0].split(","),r="";r+='<option value="">&mdash; Select Field &mdash;</option>',t.forEach(function(e,t){e=e.replace(/"/g,""),r+='<option value="'+t+'">'+e+"</option>"}),r&&(s(o).html(r),s(o).each(function(){var t=s(this).parent().parent().find("label").text(),e=s(this).find("option"),r=s(e).filter(function(){var e=s(this).html();return new RegExp(t,"i").test(e)});r&&(s(e).removeAttr("selected"),s(this).val(s(r).val()))}))}},strTitleCase:function(e){return e.replace(/_/g," ").toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},create:function(e){void 0!==e&&e.preventDefault(),void 0!==wpErpHr.employee_empty&&s.erpPopup({title:wpErpHr.popup.employee_title,button:wpErpHr.popup.employee_create,id:"erp-new-employee-popup",content:wperp.template("erp-new-employee")(wpErpHr.employee_empty).trim(),onReady:function(){l.initDateField(),s(".select2").select2(),l.employee.select2Action("erp-hrm-select2"),l.employee.select2AddMoreContent(),s("#user_notification").on("click",function(){s(this).is(":checked")?s(".show-if-notification").show():s(".show-if-notification").hide()}),s("#advanced_fields").click(function(){s(this).is(" :checked ")?(s(".employee-work").show(),s(".employee-personal").show()):(s(".employee-work").hide(),s(".employee-personal").hide())}),s("button[type=submit]").click(l.requiredAlert)},onSubmit:function(t){s("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send("erp-hr-employee-new",{data:this.serialize(),success:function(e){t.enableButton(),t.closeModal(),void 0!==e.url&&(window.location.href=e.url)},error:function(e){t.enableButton(),t.showError(e)}})}})},select2AddMoreContent:function(){var e=s(".erp-hrm-select2-add-more");s.each(e,function(e,t){l.employee.select2AddMoreActive(t)})},select2AddMoreActive:function(e){var t=s(e).data("id"),r=s(e).data("add");void 0!==r&&0<r.length?s(e).select2().on("select2:open",function(){s(".select2-results:not(:has(a))").append('<div class="erp-select2-add"><a href="#" id="'+t+'">'+r+"</a></div>")}):s(e).select2({width:"element",language:{noResults:function(){return'<a href="#" class="button button-primary" id="'+t+'">Add New</a>'}},escapeMarkup:function(e){return e}})},select2Action:function(e){s("."+e).select2({width:"element"})},edit:function(e){e.preventDefault();var t=s(this);s.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;s("header",r).after(s('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:t.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);s(".content",r).html(t),s(".loader",r).remove(),l.initDateField(),s(".select2").select2(),l.employee.select2Action("erp-hrm-select2"),l.employee.select2AddMoreContent(),s("#advanced_fields").click(function(){s(this).is(" :checked ")?(s(".employee-work").show(),s(".employee-personal").show()):(s(".employee-work").hide(),s(".employee-personal").hide())}),s("div[data-selected]",r).each(function(){var e=s(this),r=0,o=e.data("selected"),n=s("span.checkbox input[type=checkbox][required]");""!==o&&(e.find("select").val(o).trigger("change"),e.find("input[type=radio][value='"+o+"']").prop("checked",!0),s.each(e.find("input[type=checkbox]"),function(e,t){-1!=s.inArray(s(t).val(),o.split(","))?s(t).prop("checked",!0):s.inArray(s(t),n)&&r++}),r!==n.length&&s.each(e.find("span.checkbox input[type=checkbox][required]"),function(e,t){-1==s.inArray(s(t).val(),o.split(","))&&s(t).removeAttr("required")}))}),s('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}}),s("button[type=submit]").click(function(){l.requiredAlert("edit")})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){l.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=s(this);confirm(wpErpHr.delConfirmEmployee)&&wp.ajax.send("erp-hr-emp-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id"),hard:t.data("hard")},success:function(){t.closest("tr").fadeOut("fast",function(){s(this).remove(),l.employee.reload()})},error:function(e){alert(e)}})},restore:function(e){e.preventDefault();var t=s(this);confirm(wpErpHr.restoreConfirmEmployee)&&wp.ajax.send("erp-hr-emp-restore",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){s(this).remove(),l.employee.reload()})},error:function(e){alert(e)}})},toggleFilterDropdown:function(){document.getElementById("erp-dropdown-content").classList.toggle("show")},general:{create:function(e){void 0!==e&&e.preventDefault();var t=s(this);s.erpPopup({title:t.data("title"),content:wp.template(t.data("template"))(t.data("data")),extraClass:"smaller",id:"erp-hr-new-general",button:t.data("button"),onReady:function(){l.initDateField(),s(".row[data-selected]",this).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t),"percentage"===t&&(s(".education-form-wrap #scale").removeAttr("required"),s(".education-form-wrap #result_scale").fadeOut())})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=s(this);confirm(wpErpHr.confirm)&&wp.ajax.send(t.data("action"),{data:{id:t.data("id"),employee_id:t.data("employee_id"),_wpnonce:wpErpHr.nonce},success:function(){l.reloadPage()},error:function(e){alert(e)}})},selectResultType:function(e){"percentage"===s(this).val()?(s(".education-form-wrap #result_area label").html("Result (%) <span class='required'>*</span>"),s(".education-form-wrap #gpa").attr("placeholder","100"),s(".education-form-wrap #scale").removeAttr("required"),s(".education-form-wrap #result_scale").fadeOut()):(s(".education-form-wrap #result_area label").html("Result (Grade) <span class='required'>*</span>"),s(".education-form-wrap #gpa").attr("placeholder","5.0"),s(".education-form-wrap #scale").attr("required","required"),s(".education-form-wrap #result_scale").fadeIn())}},updateJobStatus:function(e){void 0!==e&&e.preventDefault();var o=s(this),n="",a="";wp.ajax.send({data:{id:s("#erp-empl-status").data("id"),action:"erp-hr-emp-get",_wpnonce:wpErpHr.nonce},success:function(t){n=t.work.status,a=t.work.type,s.erpPopup({title:o.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){t.date=wpErpHr.currentDate;var e=wp.template(o.data("template"))(t);s(".content",this).html(e),s(".row[data-selected]",this).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),l.employee.select2Action("erp-hrm-select2"),l.initDateField()},onSubmit:function(e){var r=this.serializeObject();r.status?n==r.status?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):"terminated"==r.status?(e.closeModal(),s.erpPopup({title:o.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")(r);s(".content",this).html(e),l.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})):"active"==r.status?(e.closeModal(),s.erpPopup({title:wpErpHr.popup.employment_type,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(r);s(".content",this).html(e),l.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.ajaxReq(r,t)},error:function(e){t.enableButton(),t.showError(e)}})}})):l.ajaxReq(r,e):r.type&&a==r.type?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):l.ajaxReq(r,e)}})}})},removeHistory:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-hr-emp-delete-history",{data:{history_id:s(this).data("id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce},success:function(){l.reloadPage()}})},editHistory:function(e){void 0!==e&&e.preventDefault();var t=s(this),r=t.data("id"),o=t.data("title"),n=t.data("template");wp.ajax.send({data:{history_id:r,action:"erp_hr_employee_get_job_history",_wpnonce:wpErpHr.nonce},success:function(e){s.erpPopup({title:o,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-history",content:"",extraClass:"smaller",onReady:function(){s(".content",this).html(wp.template(n)(e)),l.initDateField(),s(".row[data-selected]",this).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),l.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(e){l.reloadPage(),t.enableButton(),t.closeModal(),swal({title:"",text:e,type:"success",timer:2200,showConfirmButton:!1})},error:function(e){t.enableButton(),swal("",e,"error")}})}})}})},printData:function(e){e.preventDefault(),window.print()},checkUserEmail:function(){var r=s(this),e=r.val(),t=r.closest("form").find("#erp-employee-id").val();return!(""==e||!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))&&("0"==t&&void wp.ajax.send("erp_hr_check_user_exist",{data:{email:e,_wpnonce:wpErpHr.nonce},success:function(){var e=r.closest("form");e.find(".modal-suggession").fadeOut(300,function(){s(this).remove()}),e.find("button[type=submit]").removeAttr("disabled")},error:function(e){var t=r.closest("form");t.find("button[type=submit]").attr("disabled","disabled"),"employee"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.employee_exit+"</div>")),"wp_user"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.make_employee_text+' <a href="#" id="erp-hr-create-wp-user-to-employee" data-user_id="'+e.data.ID+'">'+wpErpHr.create_employee_text+"</a></div>")),s(".modal-suggession").hide().slideDown(function(){t.find(".content-container").css({marginTop:"15px"})})}}))},makeUserEmployee:function(e){e.preventDefault();var t=s(this),o=t.data("user_id");t.closest(".modal-suggession").append('<div class="erp-loader" style="top:9px; right:10px;"></div>'),wp.ajax.send("erp-hr-convert-wp-to-employee",{data:{user_id:o,_wpnonce:wpErpHr.nonce},success:function(){t.closest(".modal-suggession").find(".erp-loader").remove(),t.closest(".erp-modal").remove(),s(".erp-modal-backdrop").remove(),l.employee.reload(),s.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;s("header",r).after(s('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:o,_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);s(".content",r).html(t),s(".loader",r).remove(),l.initDateField(),s("div[data-selected]",r).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t).trigger("change")}),s('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){l.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},error:function(e){alert(e)}})},addNote:function(e){e.preventDefault();var t=s(this),r=t.find("input[type=submit]");r.attr("disabled","disabled"),t.find(".erp-note-loader").show(),wp.ajax.send({data:t.serializeObject(),success:function(){s.get(window.location.href,function(e){s("ul.notes-list li").length<0?s("ul.notes-list").prepend(s(e).find("ul.notes-list").after()):s("ul.notes-list").prepend(s(e).find("ul.notes-list li").first()),10<s("ul.notes-list li").length&&s("ul.notes-list li").last().remove(),l.employee.showLoadMoreBtn(),t.find(".erp-note-loader").hide(),t.find("textarea").val(""),r.removeAttr("disabled")})},error:function(){r.removeAttr("disabled"),t.find(".erp-note-loader").hide()}})},showLoadMoreBtn:function(){10<=s("ul.notes-list li").length?s(".wperp-load-more-btn").show():s(".wperp-load-more-btn").hide()},loadNotes:function(e){e.preventDefault();var t=s(this),r={action:"erp-load-more-notes",user_id:t.data("user_id"),total_no:t.data("total_no"),offset_no:t.data("offset_no")};t.closest("p").append('<span class="erp-loader" style="margin:4px 0px 0px 10px"></span>').find(".erp-loader").show(),t.attr("disabled",!0),wp.ajax.send({data:r,success:function(e){t.data("offset_no",parseInt(r.total_no)+parseInt(r.offset_no)),s(e.content).appendTo(t.closest(".note-tab-wrap").find("ul.notes-list")).hide().fadeIn(),t.removeAttr("disabled"),s(".erp-loader").remove()},error:function(e){alert(e)}})},deleteNote:function(e){if(e.preventDefault(),confirm(wpErpHr.delConfirmEmployeeNote)){var t=s(this),r={action:"erp-delete-employee-note",note_id:t.data("note_id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce};wp.ajax.send({data:r,success:function(e){t.closest("li").fadeOut(400,function(){s(this).remove(),l.employee.showLoadMoreBtn()})},error:function(e){alert(e)}})}},updatePerformance:function(e){void 0!==e&&e.preventDefault();var t=s(this);s.erpPopup({title:t.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-performance",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(window.wpErpCurrentEmployee);s(".content",this).html(e),l.initDateField(),l.employee.select2Action("erp-hrm-select2"),s(".row[data-selected]",this).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t)})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},removePerformance:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-delete-performance",id:s(this).data("id"),user_id:s(this).data("userid"),_wpnonce:wpErpHr.nonce},success:function(){l.reloadPage()}})},terminateEmployee:function(e){void 0!==e&&e.preventDefault();var t=s(this),r=t.data("data")?t.data("data"):window.wpErpCurrentEmployee;r.date=wpErpHr.currentDate,s.erpPopup({title:t.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(r);s(".content",this).html(e),l.initDateField(),s(".row[data-selected]",this).each(function(){var e=s(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),l.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},activateEmployee:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-activate",id:s(this).data("id"),_wpnonce:wpErpHr.nonce},success:function(){l.reloadPage()}})},changeEmployeeStatus:function(e){e.preventDefault();var r=(a=s(this)).closest("form"),t=r.find("select#erp-hr-employee-status-option"),o=t.val(),n=t.attr("data-selected");if("terminated"==o)o!=n?s.erpPopup({title:a.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")({});s(".content",this).html(e),l.initDateField(),l.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){l.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}}):alert(wpErpHr.popup.already_terminate);else if("active"==o)if(o!=n){var a=s(this);s.erpPopup({title:wpErpHr.popup.employment_status,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(window.wpErpCurrentEmployee);s(".content",this).html(e),l.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),r.submit()},error:function(e){t.enableButton(),t.showError(e)}})}})}else alert(wpErpHr.popup.already_active);else r.submit()}},announcement:{validateFilterForm:function(e){e.preventDefault();var t=s("#start_date").val(),r=s("#end_date").val();t&&r?(t=new Date(t).getTime(),(r=new Date(r).getTime())<t?swal(wpErpHr.invalid_filter_data,wpErpHr.start_end_date,"error"):s("#erp-announcement-table-wrap .list-table-inner form").submit()):swal("",wpErpHr.invalid_filter_data,"warning")},sentToDetails:function(e){var t=s(e.target).data("more-content");s.erpPopup({title:wpErpHr.popup.sent_to,button:"",id:"erp-hr-announcement-sent-to-details",content:_.template("<% print( all_send_to ) %>")({all_send_to:t}),extraClass:"smaller"})}}};s(function(){l.initialize()})}(jQuery);